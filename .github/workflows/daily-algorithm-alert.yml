name: daily-algorithm-alert

on:
  schedule:
    - cron: '0 0 * * *'  # Run daily at 9 AM
    - cron: '0 0 * * 1'  # Run weekly on Mondays at 9 AM
    - cron: '0 11 1 * *'  # Run monthly on the 1st at 8 PM

jobs:
  bulid:
    runs-on: ubuntu-latest

    steps:
      - name: print current time in workflow
        run: date

      - name: checkout repository
        uses: actions/checkout@v4

      - name: POST algorithm repository daily alert to SLACK
        id: run-output-script
        run: bash shell-scripts/statistics-algorithm-java-files.sh

      - name: Send SLACK Notification
        run: |
          # Counting
          DAILY_COUNT="${{ steps.run-output-script.outputs.DAILY_JAVA_COUNT }}"
          WEEKLY_COUNT="${{ steps.run-output-script.outputs.WEEKLY_JAVA_COUNT }}"
          MONTHLY_COUNT="${{ steps.run-output-script.outputs.MONTHLY_JAVA_COUNT }}"
          
          # Slack Message Send & Statistics
          if [ ${DAILY_COUNT} -lt 1 ]
          then 
            MSG="ë” ë¶„ë°œí•´ì•¼ í•  ê²ƒ ê°™ì•„ìš”!"
          elif [ ${DAILY_COUNT} -ge 2 -a ${DAILY_COUNT} -lt 3 ]
            MSG="ì§€ê¸ˆê¹Œì§€ ì˜í•˜ê³  ê³„ì‹œë„¤ìš”. í™”ì´íŒ…ì…ë‹ˆë‹¤!ğŸ˜"
          then
            MSG="ëª©í‘œë¥¼ ê±°ì˜ ë‹¬ì„±í•˜ì…¨ì–´ìš”! ëŒ€ë‹¨í•©ë‹ˆë‹¤."
          else
            MSG="3 ë¬¸ì œ ì´ìƒ í‘¸ì…”ì„œ, ë„ˆë¬´ë„ˆë¬´ ì¡´ê²½ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.ğŸ¥¹"
          fi
          
          echo "------DATE------"
          NOW_YEAR=$(date +%Y)  
          NOW_MONTH=$(date +%0m)
          NOW_DATE=$(date +%Y.%m.%d)
          echo "------DATE------"
          
          # algorithm State Alert
          DAILY_MSG="ì•Œê³ ë¦¬ì¦˜ í’€ê¸° ì¢‹ì€ ë°¤ì´ì£ ?\nì˜¤ëŠ˜ë‚ ì§œ($NOW_DATE) ê¸°ì¤€ìœ¼ë¡œ *${NOW_YEAR}ë…„ ${NOW_MONTH}ì›” ${DAILY_COUNT}ê°œ ë‹¬ì„±í•˜ì…¨ì–´ìš”!\ní†µê³„ë¥¼ ë§ì”€ë“œë¦¬ìë©´, ì£¼ê°„ ${WEEKLY_COUNT}ê°œ, ì›”ê°„ ${MONTHLY_COUNT}ê°œ ì…ë‹ˆë‹¤!\n${MSG}
          
          # SLACK channel to SEND
          curl -X POST --data-urlencode "payload={\"channel\": \"ì½”ë”©í…ŒìŠ¤íŠ¸-ì•Œê³ ë¦¬ì¦˜\", \"username\": \"ì½”í…Œì•Œ-ë¦¬ë¯¸\", \"text\": \"${DAILY_MSG}\", \"icon_emoji\": \":male-technologist:\"}"{% raw %}${{ secrets.SLACK_WEBHOOKS_URL }}{% endraw %}
          
            
  


