name: daily-algorithm-alert

on:
  schedule:
    - cron: '0 11 * * *'   # Run daily at 8 PM
    - cron: '0 11 * * 1'   # Run weekly on Mondays at 8 PM
    - cron: '0 11 1 * *'  # Run monthly on the 1st at 8 PM

jobs:
  alert-build:
    runs-on: ubuntu-latest

    steps:
      - name: Print Current time in workflow
        run: date

      - name: checkout repository
        uses: actions/checkout@v4

      #- name: POST algorithm repository daily alert to SLACK
      #  id: run-output-script
      #  run: bash shell-scripts/statistics-algorithm-java-files.sh

      - name: Run Shell Script to Count Java Files
        run: |
          chmod +x ./shell-scripts/cal-months-algorithm-slove.sh  # ìŠ¤í¬ë¦½íŠ¸ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
          bash shell-scripts/cal-months-algorithm-slove.sh 6   # ê³¼ê±° 6ê°œì›” ì „ë¶€í„° í˜„ì¬ê¹Œì§€ íŒŒì¼ ê°œìˆ˜ ê³„ì‚°

      - name: Send slack Notification
        run: |
          # Counting
          echo "====slack Message Send & staticstics===============" 
          
          # í˜„ì¬ ë‚ ì§œ ë° ê³„ì‚°ì„ ìœ„í•œ ê¸°ë³¸ ë³€ìˆ˜ ì„¤ì •
          echo -e "\e[31m===================DATE==================="
          TODAY=$(date +%Y-%m-%d)                             # ì˜¤ëŠ˜ ë‚ ì§œ (YYYY-MM-DD í˜•ì‹)
          YESTERDAY=$(date -d "yesterday" +%Y-%m-%d)          # ì–´ì œ ë‚ ì§œ
          SEVEN_DAYS_AGO=$(date -d "7 days ago" +%Y-%m-%d)    # ì¼ì£¼ì¼ ì „ ë‚ ì§œ
          THIRTY_DAYS_AGO=$(date -d "30 days ago" +%Y-%m-%d)  # í•œ ë‹¬ ì „ ë‚ ì§œ
          NOW_YEAR=$(date +%Y)  
          NOW_MONTH=$(date +%0m)
          NOW_DATE=$(date +%d)
          echo ${NOW_YEAR}-${NOW_MONTH}-${NOW_DATE}
          echo -e "\e[31m===================DATE==================="
          
          DAILY_COUNT=$(find src -type f -name "*.java" -newermt "${YESTERDAY}" ! -newermt "${TODAY}" | wc -l)
          WEEKLY_COUNT=$(find src -type f -name "*.java" -newermt "${SEVEN_DAYS_AGO}" ! -newermt "${TODAY}" | wc -l)
          MONTHLY_COUNT=$(find src -type f -name "*.java" -newermt "${THIRTY_DAYS_AGO}" ! -newermt "${TODAY}" | wc -l)
          
          TARGET_FILE_PATH='src'
          
          echo -e "\e[31m+=========================================+";
          echo -e "\e[32mJava Files Created Yesterday: ${DAILY_COUNT}"
          echo -e "\e[32mJava Files Created Last 7 Days: ${WEEKLY_COUNT}"
          echo -e "\e[32mJava Files Created Last 30 Days: ${MONTHLY_COUNT}"
          echo -e "\e[31m+=========================================+";
  
          # Slack Message Send & Statistics
          if [ ${DAILY_COUNT} -lt 1 ]; then 
            MSG="ë” ë¶„ë°œí•´ì•¼ í•  ê²ƒ ê°™ì•„ìš”!"
          elif [ ${DAILY_COUNT} -ge 2 -a ${DAILY_COUNT} -lt 3 ]; then
            MSG="ì§€ê¸ˆê¹Œì§€ ì˜í•˜ê³  ê³„ì‹œë„¤ìš”. í™”ì´íŒ…ì…ë‹ˆë‹¤!"
          elif [ ${DAILY_COUNT} -ge 3 -a ${DAILY_COUNT} -lt 4 ]; then
            MSG="ëª©í‘œë¥¼ ê±°ì˜ ë‹¬ì„±í•˜ì…¨ì–´ìš”! ëŒ€ë‹¨í•©ë‹ˆë‹¤."
          else
            MSG="4 ë¬¸ì œ ì´ìƒ í‘¸ì…”ì„œ, ì¡´ê²½ìŠ¤ëŸ½ìŠµë‹ˆë‹¤."
          fi
          echo "====slack Message Send & staticstics===============" 
          
          # algorithm State Alert
          COUNT_MSG="\n#--------------------------------#\n"
          
          DAILY_MSG="ì•Œê³ ë¦¬ì¦˜ í’€ê¸°ì— ë”± ì¢‹ì€ ë°¤ì´ë„¤ìš”!\n*ì˜¤ëŠ˜ ë‚ ì§œ_(${TODAY})_ê¸°ì¤€ìœ¼ë¡œ, ë²Œì¨ *${NOW_YEAR}ë…„ ${NOW_MONTH}ì›”ì— ${DAILY_COUNT}ë¬¸ì œë¥¼ í•´ê²°í•˜ì…¨ì–´ìš”!*\ní†µê³„ë¥¼ ë³´ë©´, ì´ë²ˆ ì£¼ì—ëŠ” ${WEEKLY_COUNT}ë¬¸ì œ, ì´ë²ˆ ë‹¬ì—ëŠ” ${MONTHLY_COUNT}ë¬¸ì œë¥¼ í‘¸ì…¨ìŠµë‹ˆë‹¤! ${MSG}\nìì„¸í•œ ë‚´ìš©ì„ ë³´ì‹œë ¤ë©´ <https://github.com/yeeooni/baekjoon-slove|ì—¬ê¸°>ë¥¼ í´ë¦­í•˜ì„¸ìš”."
          COUNT_MSG+="${NOW_YEAR}ë…„ ${{ env.MONTHS_AGO }}ê°œì›” ì „ë¶€í„° í˜„ì¬ê¹Œì§€ í•´ê²°í•œ ë¬¸ì œ\n*ì´ ${{ env.JAVA_FILE_COUNT }}ë¬¸ì œ*\n*í›Œë¥­í•©ë‹ˆë‹¤!* ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ë“œë””ì–´ ê²°ì‹¤ì„ ë³´ê³  ìˆì–´ìš”. ë‹¤ìŒ ë‹¬ë„ í™”ì´íŒ…! ğŸ‰ğŸš€"
          
          # SLACK channel to SEND
          curl -X POST --data-urlencode "payload={\"text\": \"${DAILY_MSG}${COUNT_MSG}\"}" ${{ secrets.SLACK_WEBHOOKS_URL }}
          
            
          
          
          
