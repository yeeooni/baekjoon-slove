name: weekly-algorithm-alert

on:
  schedule:
    - cron: '0 9 * * 5'   # Run weekly on Fridays at 8 PM

jobs:
  alert-build:
    runs-on: ubuntu-latest

    steps:
      - name: checkout repository
        uses: actions/checkout@v4

      - name: Set Timezone to Asia/Seoul
        run: sudo timedatectl set-timezone Asia/Seoul

      - name: Run Shell Script to Count Java Files
        run: |
            chmod +x ./shell-scripts/cal-months-algorithm-slove.sh  # ìŠ¤í¬ë¦½íŠ¸ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
            bash shell-scripts/cal-months-algorithm-slove.sh 6   # ê³¼ê±° 6ê°œì›” ì „ë¶€í„° í˜„ì¬ê¹Œì§€ íŒŒì¼ ê°œìˆ˜ ê³„ì‚°

      - name: Slack Message Send & Statistics
        run: |
          COUNT_MSG="\n#--------------------------------#\n"
          COUNT_MSG+="$(date +%Y)ë…„ ${{ env.MONTH_AGO }}ê°œì›” ì „ë¶€í„° í˜„ì¬ê¹Œì§€ í•´ê²°í•œ ë¬¸ì œ\n\n*ì´ ${{ env.JAVA_FILE_COUNT }}ë¬¸ì œ*, *í›Œë¥­í•©ë‹ˆë‹¤!*\nê¾¸ì¤€í•œ ë…¸ë ¥ì´ ë“œë””ì–´ ê²°ì‹¤ì„ ë³´ê³  ìˆì–´ìš”. ë‹¤ìŒ ë‹¬ë„ í™”ì´íŒ…! ğŸ‰ğŸš€"
          COUNT_MSG="\n#--------------------------------#\n"
          
          # SLACK channel to SEND
          curl -X POST --data-urlencode "payload={\"text\": \"${COUNT_MSG}\"}" ${{ secrets.SLACK_WEBHOOKS_URL }}